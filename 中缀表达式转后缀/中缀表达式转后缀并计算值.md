[P1175 表达式的转换 - 洛谷](https://www.luogu.com.cn/problem/P1175)

```java
import java.io.*;
import java.util.*;

public class Main {
    static BufferedReader br;
    static PrintWriter pw;
    public static void main(String[] args) throws IOException {
        br = new BufferedReader(new InputStreamReader(System.in));
        pw = new PrintWriter(new BufferedWriter(new OutputStreamWriter(System.out)));
        //
        String x = br.readLine();
        Deque<String> res = new LinkedList<>(),help = new LinkedList<>();
        int i = 0,n = x.length();
        while(i < n){
            char c = x.charAt(i);
            if(c < '0' || c > '9'){
                if(c == '('){
                    help.addLast(String.valueOf(c));
                }else if(c == ')'){
                    while(!help.isEmpty() && help.peekLast().charAt(0) != '('){
                        res.addLast(String.valueOf(help.removeLast()));
                    }
                    if(!help.isEmpty())help.removeLast();
                }else{
                    while(!help.isEmpty() && (you(help.peekLast().charAt(0)) > you(c)
                            || (you(help.peekLast().charAt(0)) == you(c) && c != '^'))){
                        res.addLast(help.removeLast());
                    }
                    help.addLast(String.valueOf(c));
                }
                i++;
            }else{
                int now = 0;
                while(i < n && x.charAt(i) >= '0' && x.charAt(i) <= '9'){
                    now = now * 10 + x.charAt(i) - '0';
                    i++;
                }
                res.addLast(String.valueOf(now));
            }
        }
        while(!help.isEmpty()){
            res.addLast(help.removeLast());
        }
        work(res);
        //
        pw.flush();
        pw.close();br.close();
    }
    public static void work(Deque<String> res)throws IOException{
        boolean f= false;
        for(String s : res){
            if(f)pw.print(" ");
            pw.print(s);
            f = true;
        }pw.println();
        Deque<Integer> help = new LinkedList<>();
        while(!res.isEmpty()){
            String now = res.removeFirst();
            if(now.charAt(0) >= '0' && now.charAt(0) <= '9'){
                help.addLast(Integer.parseInt(now));
            }else{
                Integer b = help.removeLast(),a = help.removeLast();
                if(now.charAt(0) == '+'){
                    help.addLast(a+b);
                }else if(now.charAt(0) == '-'){
                    help.addLast(a-b);
                }else if(now.charAt(0) == '*'){
                    help.addLast(a*b);
                }else if(now.charAt(0) == '/'){
                    help.addLast(a/b);
                }else if(now.charAt(0) == '%'){
                    help.addLast(a%b);
                }else if(now.charAt(0) == '^'){
                    help.addLast((int) Math.pow(a,b));
                }f = false;
                for(Integer i : help){
                    if(f)pw.print(" ");
                    pw.print(i);
                    f = true;
                }
                for(String i:res){
                    if(f)pw.print(" ");
                    pw.print(i);
                }
                pw.println();
            }
        }
    }
    public static int you(char c){
        if(c == '+' || c == '-')return 1;
        if(c == '*' || c == '/' || c == '%')return 2;
        if(c == '^')return 3;
        return 0;
    }


}

```
