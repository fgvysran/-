[P1972 [SDOI2009] HH 的项链 - 洛谷](https://www.luogu.com.cn/problem/P1972)



```java
import java.io.*;
import java.util.*;

public class Main {
    static final int MAX = 1_000_007;
    //static int[]bi = new int[MAX];
    static int[][]query = new int[MAX][3];
    static int[]a = new int[MAX];
    static int kind = 0;
    static int[]cnt = new int[MAX];
    public static void main(String[] args) throws IOException {
        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
        PrintWriter pw = new PrintWriter(new BufferedWriter(new OutputStreamWriter(System.out)));
        //
        int[]ans = new int[MAX];
        int n = Integer.parseInt(br.readLine());
        StringTokenizer st = new StringTokenizer(br.readLine());
        for (int i = 1; i <= n; i++) {
            a[i] = Integer.parseInt(st.nextToken());
        }
        int m = Integer.parseInt(br.readLine());
        for(int i = 1;i <= m;i++) {
            st = new StringTokenizer(br.readLine());
            query[i][0] = Integer.parseInt(st.nextToken());
            query[i][1] = Integer.parseInt(st.nextToken());
            query[i][2] = i;;
        }
        int block = (int)Math.sqrt(n);
        Arrays.sort(query, 1, m + 1, (o1, o2) -> {
            int b1 = o1[0] / block, b2 = o2[0] / block;
            if (b1 != b2) return b1 - b2;
            return ((b1 & 1) == 1) ? (o1[1] - o2[1]) : (o2[1] - o1[1]);
        });
        int winL = 1,winR = 0;
        for(int i = 1;i <= m;i++){
            int l = query[i][0],r = query[i][1];
            while(winR < r){
                add(a[++winR]);
            }
            while(r < winR){
                del(a[winR--]);
            }
            while(winL < l){
                del(a[winL++]);
            }
            while(l < winL){
                add(a[--winL]);
            }

            ans[query[i][2]] = kind;
        }
        for(int i = 1;i <= m;i++){
            pw.println(ans[i]);
        }
        //
        pw.flush();
        pw.close();br.close();
    }
    public static void add(int num){
        if(++cnt[num] == 1)kind++;
    }
    public static void del(int num){
        if(--cnt[num] == 0)kind--;
    }


}

```
